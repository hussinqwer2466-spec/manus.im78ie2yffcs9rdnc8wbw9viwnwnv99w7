"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[48209],{21878:(e,t,l)=>{l.d(t,{l:()=>m});var a=l(2635),i=l(75958),n=l(75772),s=l(57271),r=l(85335),o=l(82518),d=l(99515),c=l(10737);let u=r.A.generatePicker(o.A);function m(e){let{suffixIcon:t=null,...l}=e,[r,o]=(0,d.useState)(null),m=(0,i.w)(async()=>{let e=await (0,c.e)(s.I.translationManager.locale);e&&o(e.default)});(0,d.useEffect)(()=>{m()},[m]);let h=n.b.getDialogRoot();return h?(0,a.jsx)(u,{locale:null!=r?r:void 0,getPopupContainer:()=>h,suffixIcon:t,...l}):null}},10737:(e,t,l)=>{l.d(t,{e:()=>a});function a(e){return"de"===e?l.e(39216).then(l.bind(l,39216)):"en"===e?Promise.resolve().then(l.bind(l,62542)):"es"===e?l.e(28435).then(l.bind(l,28435)):"fr"===e?l.e(95467).then(l.bind(l,95467)):"it"===e?l.e(85977).then(l.bind(l,8358)):"pt-PT"===e?l.e(25329).then(l.bind(l,25329)):"pt-BR"===e?l.e(69546).then(l.bind(l,69546)):"zh-CN"===e?l.e(3610).then(l.bind(l,3610)):"zh-TW"===e?l.e(4554).then(l.bind(l,4554)):"ja"===e?l.e(53787).then(l.bind(l,53787)):"ko"===e?l.e(18539).then(l.bind(l,18539)):"ar"===e?l.e(37189).then(l.bind(l,37189)):"es-419"===e?l.e(28435).then(l.bind(l,28435)):"vi"===e?l.e(53670).then(l.bind(l,53670)):"tr"===e?l.e(12055).then(l.bind(l,12055)):"th"===e?l.e(49473).then(l.bind(l,49473)):"hi"===e?l.e(88388).then(l.bind(l,88388)):null}},72031:(e,t,l)=>{l.d(t,{_:()=>g});var a=l(90921),i=l(57258),n=l(80926),s=l(51416),r=l(75958),o=l(93347),d=l(21284),c=l(23757),u=l(15003),m=l(29313),h=l(76081),x=l(7171),v=l(98417),p=l(4890),f=l(76656),y=l(57271);function g(){let e=(0,d.jL)(),{open:t}=(0,s.s)(h.A),{open:l}=(0,s.s)(p.Z),g=(0,s.s)(v._),{sendQuestion:b}=(0,a.K)(),{handleNewSession:w}=(0,i.B)(),j=(0,r.w)(()=>u.A.selectors.scheduleList(d.M_.getState())),I=(0,r.w)(e=>j().find(t=>t.uid===e)),S=(0,r.w)(t=>{e(u.A.actions.setScheduleList(t))}),N=(0,r.w)(async()=>{let t=await o.F.SessionService.listScheduledTasks({page:1,pageSize:9999,withDeleted:!0});if(null==t?void 0:t.tasks){let l=t.tasks;e(u.A.actions.setScheduleList(l)),t.nextTask?e(u.A.actions.setNextScheduleInfo(t.nextTask)):e(u.A.actions.setNextScheduleInfo(null))}else e(u.A.actions.setScheduleList([])),e(u.A.actions.setNextScheduleInfo(null));return t}),T=(0,r.w)(async e=>{w(),await b({question:e.detail},{scheduleTask:{...e,detail:e.detail,name:e.name,uid:e.uid,locale:y.I.translationManager.locale,parentSessionUid:e.parentSessionUid,parentTitle:e.name}})}),k=(0,r.w)(async t=>{let l=j();if(t.uid&&!(null==l?void 0:l.some(e=>e.uid===t.uid))){let l={...(0,x.m)(),...t,createdAt:void 0};e(u.A.actions.addSchedule(l))}}),A=(0,r.w)(async t=>{var l;let a={...t,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,locale:y.I.translationManager.locale,scheduleTime:{...t.scheduleTime,time:Math.floor((null==t?void 0:null===(l=t.scheduleTime)||void 0===l?void 0:l.time)||0)},connectorUids:t.connectors.map(e=>e.uid)},i=await o.F.SessionService.createScheduledTask(a);e(u.A.actions.addSchedule({...a,uid:i.uid}))}),E=(0,r.w)(async t=>{await o.F.SessionService.deleteScheduledTask({uid:t.uid}),e(u.A.actions.deleteSchedule(t))}),D=(0,r.w)(async t=>{var l;let a={...t,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,scheduleTime:{...t.scheduleTime,time:Math.floor((null==t?void 0:null===(l=t.scheduleTime)||void 0===l?void 0:l.time)||0)},connectorUids:t.connectors.map(e=>e.uid)},{status:i}=await o.F.SessionService.updateScheduledTask(a);e(u.A.actions.updateSchedule({...a,status:i}))}),_=(0,r.w)(async e=>{let{uid:t,isEnable:l}=e,a=j();if(!(null==a?void 0:a.length))return;let i=a.find(e=>e.uid===t);if(!i)return;let n={...i,isEnable:l,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone};await D(n)});return{setList:S,getList:N,addItem:A,addItemExist:k,deleteItem:E,updateItem:D,updateScheduleStatus:_,checkScheduleStatusForUpgrade:(0,r.w)((e,l)=>{var a;if(!e)return!1;let i=c.R.selectors.userInfo(d.M_.getState()),s=j();return null!=s&&!!s.length&&!(s.filter(e=>{let t=e.status===f.L4.DELETE;return l?e.uid!==l&&e.isEnable&&!t:e.isEnable&&!t}).length<(null!==(a=null==i?void 0:i.concurrentScheduleTaskLimit)&&void 0!==a?a:5))&&((0,n.C)({eventName:"limit_dialog_show",extData:{source:"edit_schedule_task"}}),t(),!0)}),getLocalScheduleById:I,getRemoteScheduleStatusById:(0,r.w)(async e=>{if(e)return await o.F.SessionService.getScheduledTaskStatus({uid:e})}),triggerScheduledTaskNow:T,openScheduleFormDialog:(0,r.w)(e=>{let{dataSource:t}=e;if(m.u.isTeamExpired(d.M_.getState())){l({limitType:"schedule"});return}g.open({dataSource:t})})}}},76081:(e,t,l)=>{l.d(t,{A:()=>v});var a=l(2635),i=l(76743),n=l(33890),s=l(80926),r=l(51416),o=l(73677),d=l(23757),c=l(34143),u=l(57271),m=l(59728),h=l(99515),x=l(10417);function v(e){let{onDisposed:t}=e,l=(0,o.GV)(d.R.selectors.userInfo),v=!(0,o.GV)(d.R.selectors.isTeamAccount)&&!(0,c.oD)(null==l?void 0:l.membershipVersion),{open:p}=(0,r.s)(x.v);return(0,h.useEffect)(()=>{v?(0,s.C)({eventName:"feature_block_upgrade_sheet_show",extData:{source:"schedule_task"}}):(0,s.C)({eventName:"feature_block_sheet_show_web",extData:{source:"schedule_task"}})},[v]),(0,a.jsx)(n.l,{width:460,onDisposed:t,className:"max-w-[90%]",headerClassName:"none p-0",children:(0,a.jsxs)("div",{className:"flex flex-col items-center pt-[44px] pb-[32px] px-8",children:[(0,a.jsx)(m.A,{size:48,className:"text-[var(--text-primary)]"}),(0,a.jsxs)("div",{className:"mt-5",children:[(0,a.jsx)("p",{className:"text-[var(--text-primary)] text-center text-2xl font-[600] leading-[30px]",children:u.I.t("Scheduled task limit reached")}),(0,a.jsx)("div",{className:"mt-2 text-[var(--text-tertiary)] text-center text-sm leading-[22px] whitespace-pre-line",children:v?u.I.t("You've used all your scheduled tasks.\nUpgrade your plan to unlock more."):u.I.t("You've used all your scheduled tasks.")})]}),(0,a.jsx)("div",{className:"mt-8 flex justify-between gap-3 w-full",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.A,{className:"flex-1 h-10 ",variant:"outline",size:"medium",onClick:t,children:u.I.t("Cancel")}),(0,a.jsx)(i.A,{className:"flex-1 h-10",variant:"default",size:"medium",color:"black",onClick:()=>{t(),p(),(0,s.C)({eventName:"limit_dialog_upgrade_click",extData:{source:"schedule_task_limit"}}),(0,s.C)({eventName:"feature_block_upgrade_sheet_click",extData:{source:"schedule_task"}})},children:u.I.t("Upgrade now")})]}):(0,a.jsx)(i.A,{className:"flex-1 h-10",variant:"default",size:"medium",color:"black",onClick:t,children:u.I.t("Got it")})})]})})}},69595:(e,t,l)=>{l.d(t,{p:()=>W});var a=l(2635),i=l(76743),n=l(90293),s=l(41661),r=l(7487),o=l(67260),d=l(88387),c=l(19562),u=l(72031),m=l(15585),h=l(15038),x=l(80926),v=l(51416),p=l(75958),f=l(9205),y=l(76656),g=l(57271),b=l(16516),w=l(99515),j=l(76081),I=l(55185),S=l(93578),N=l(92803),T=l(31867),k=l(73677),A=l(10065),E=l(83532),D=l(48046),_=l(94842);function C(e){let{isMobile:t,formData:l,setFormData:i}=e,{isDark:n}=(0,T.D)();return(0,a.jsx)(S.A,{className:"w-[var(--anchor-width)]",closeWhenClickPopoverContent:!1,content:(0,a.jsx)(U,{isMobile:t,formData:l,setFormData:i}),children:(0,a.jsxs)("div",{className:"bg-[var(--fill-tsp-white-main)] rounded-[10px] py-[8px] pl-[16px] pr-[12px] flex items-center justify-between w-full cursor-pointer",children:[l.connectors.length>0?(0,a.jsx)("div",{className:"flex items-center gap-[12px]",children:l.connectors.slice(0,3).map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,a.jsx)(I.z,{uid:e.uid,size:16,defaultIconUrl:n?e.iconUrlDark:e.iconUrl}),(0,a.jsxs)("p",{className:"text-[14px] text-[var(--text-primary)] leading-[20px]",children:[(0,a.jsx)("span",{children:e.name}),l.connectors.length>3&&2===t&&(0,a.jsx)("span",{children:" +".concat(l.connectors.length-3)})]})]},e.uid))}):(0,a.jsx)("p",{className:"text-[14px] text-[var(--text-disable)] leading-[20px]",children:g.I.t("Select connectors")}),(0,a.jsx)(E.A,{size:16,color:"var(--icon-tertiary)"})]})})}function U(e){let{isMobile:t,formData:l,setFormData:i}=e,{fetchListConnectors:n}=(0,N.o)(),[s,o]=(0,w.useState)(!1),d=(0,k.GV)(A.h.selectors.installedConnectors),c=(0,p.w)(async()=>{(t||0===d.length)&&(o(!0),await n(),o(!1))});(0,w.useEffect)(()=>{c()},[c]);let u=e=>{let{uid:t,name:a,iconUrl:n,iconUrlDark:s}=e;l.connectors.some(e=>e.uid===t)?i({...l,connectors:l.connectors.filter(e=>e.uid!==t)}):i({...l,connectors:[...l.connectors,{uid:t,name:a,iconUrl:n,iconUrlDark:s,$typeName:"session.v1.ConnectorInfo"}]})};return(0,a.jsx)("div",{className:"bg-[var(--background-menu-white)] rounded-[12px] border border-white/5 shadow-lg",children:(0,a.jsx)("div",{className:"p-1 flex flex-col max-h-[400px] overflow-y-auto",children:d.length>0?d.map(e=>(0,a.jsxs)("div",{className:"p-[8px] hover:bg-[var(--fill-tsp-white-main)] rounded-[6px] flex items-center justify-between cursor-pointer",onClick:()=>u(e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-[8px]",children:[(0,a.jsx)("div",{className:"size-[20px] flex items-center justify-center",children:(0,a.jsx)(I.z,{uid:e.uid,size:16})}),(0,a.jsx)("p",{className:"text-[14px] text-[var(--text-primary)] leading-[20px]",children:e.name})]}),l.connectors.some(t=>t.uid===e.uid)&&(0,a.jsx)(D.A,{size:16,color:"var(--icon-primary)"})]},e.uid)):s?(0,a.jsx)("div",{className:"flex items-center justify-center p-[8px] h-[36px]",children:(0,a.jsx)(r.R,{size:16,color:"var(--icon-tertiary)"})}):(0,a.jsx)(z,{})})})}function z(){return(0,a.jsxs)("div",{className:"p-[8px] flex items-center gap-[8px]",children:[(0,a.jsx)("div",{className:"size-[20px] flex items-center justify-center",children:(0,a.jsx)(_.A,{size:16,color:"var(--icon-tertiary)"})}),(0,a.jsx)("p",{className:"text-[14px] text-[var(--text-tertiary)] leading-[20px]",children:g.I.t("No available connectors")})]})}var L=l(21878),M=l(78308),F=l(53708),R=l(7171),P=l(19413),O=l(30693);function Y(e){var t,l,i,n,s,r,o,d;let{formData:c,setFormData:u}=e,[h,x]=(0,w.useState)(!1),[v,f]=(0,w.useState)(!1),[j,I]=(0,w.useState)(!1),[N,T]=(0,w.useState)(!1),k=(0,p.w)(()=>{var e,t;(null===(e=c.scheduleTime)||void 0===e?void 0:e.type)===y.uS.INTERVAL&&I(!0),(null===(t=c.scheduleTime)||void 0===t?void 0:t.type)===y.uS.NO_REPEAT&&T(!0)});(0,w.useEffect)(()=>{var e;h&&(null==c?void 0:null===(e=c.scheduleTime)||void 0===e?void 0:e.second)!==void 0&&setTimeout(()=>{var e;let t=document.getElementById("time-option-".concat(null===(e=c.scheduleTime)||void 0===e?void 0:e.second));t&&t.scrollIntoView({block:"center"})},100)},[h]),(0,w.useEffect)(()=>{var e,t;v&&(null==c?void 0:null===(t=c.scheduleTime)||void 0===t?void 0:null===(e=t.date)||void 0===e?void 0:e.length)&&setTimeout(()=>{var e,t;let l=null===(t=c.scheduleTime)||void 0===t?void 0:null===(e=t.date)||void 0===e?void 0:e[0];if(void 0!==l){let e=document.getElementById("date-option-".concat(l));e&&e.scrollIntoView({block:"center"})}},100)},[v]),(0,w.useEffect)(()=>{k()},[k]);let A=(0,F.W)(()=>{let e=[{value:y.uS.DAILY,label:g.I.t("Daily")},{value:y.uS.WEEKLY,label:g.I.t("Weekly")},{value:y.uS.MONTHLY,label:g.I.t("Monthly")}];return N&&e.push({value:y.uS.NO_REPEAT,label:g.I.t("No Repeat")}),j&&e.push({value:y.uS.INTERVAL,label:g.I.t("Custom")}),e}),_=(0,p.w)(e=>{let{scheduleTime:t}=(0,b.A)(c);t&&e===y.uS.NO_REPEAT?(t.time=new Date().getTime()/1e3,t.date=[]):t&&e===y.uS.DAILY?(t.time=0,t.date=[]):t&&e===y.uS.INTERVAL?(t.time=0,t.date=[]):t&&(t.time=0,t.date=[1]),u({...c,scheduleTime:{...t||(0,R.m)().scheduleTime,type:e}})}),C=(0,p.w)(()=>{var e;return(0,a.jsx)(S.A,{className:"w-[var(--anchor-width)]",content:(0,a.jsx)("div",{className:"bg-[var(--background-menu-white)] rounded-lg border border-white/5 shadow-lg cursor-pointer",children:(0,a.jsx)("div",{className:"px-1 py-1 flex flex-col gap-0.5",children:A.map(e=>{var t;let{label:l,value:i}=e,n=(null===(t=c.scheduleTime)||void 0===t?void 0:t.type)===i;return(0,a.jsxs)("div",{className:(0,m.cn)("h-9 px-2 py-2 rounded-md flex items-center justify-between cursor-pointer","hover:bg-[var(--fill-tsp-white-main)]"),onClick:()=>_(i),children:[(0,a.jsx)("span",{className:"text-[var(--text-primary)] text-[14px] leading-[22px] font-normal",children:l}),n&&(0,a.jsx)(D.A,{size:16,className:"text-[var(--icon-primary)]"})]},i)})})}),children:(0,a.jsxs)("div",{className:(0,m.cn)("w-full flex items-center justify-between gap-2 pl-[16px] pr-[12px] h-[36px]","rounded-lg","text-sm text-[var(--text-primary)]","bg-[var(--fill-tsp-white-main)]","hover:bg-[var(--fill-tsp-white-light)]","cursor-pointer"),children:[(0,a.jsx)("span",{children:null===(e=A.find(e=>{var t;return e.value===(null===(t=c.scheduleTime)||void 0===t?void 0:t.type)}))||void 0===e?void 0:e.label}),(0,a.jsx)(E.A,{size:16,color:"var(--icon-tertiary)"})]})})}),U=(0,p.w)(()=>{var e;return(0,a.jsx)(L.l,{value:new Date(O.K.getDayStartTimeStamp(new Date(1e3*((null===(e=c.scheduleTime)||void 0===e?void 0:e.time)||0)))),onChange:e=>{u({...c,scheduleTime:{...(null==c?void 0:c.scheduleTime)||(0,R.m)().scheduleTime,time:O.K.getDayStartTimeStamp(e)/1e3}})},className:"bg-[var(--fill-tsp-white-main)] w-full h-[36px] rounded-lg hover:bg-[var(--fill-tsp-white-main)] !shadow-none cursor-pointer border-none",format:["zh-CN","zh-TW","zh-HK"].includes(g.I.translationManager.locale)?"YYYY/MM/DD":"LLL d, yyyy",placeholder:g.I.t("Select date"),allowClear:!1,inputReadOnly:!0})}),z=(0,p.w)((e,t)=>(0,a.jsx)(S.A,{onVisibleChange:f,closeWhenClickPopoverContent:!1,className:"w-[var(--anchor-width)]",content:(0,a.jsx)("div",{className:"bg-[var(--background-menu-white)] rounded-lg border border-white/5 shadow-lg",children:(0,a.jsx)("div",{className:"px-1 py-1 flex flex-col gap-0.5 max-h-[260px] overflow-y-auto",children:t.map(t=>(0,a.jsxs)("div",{id:"date-option-".concat(t.value),className:(0,m.cn)("h-9 px-2 py-2 rounded-md flex items-center justify-between cursor-pointer","hover:bg-[var(--fill-tsp-white-main)]"),onClick:()=>{let l;l=e.includes(t.value)?e.length>1?e.filter(e=>e!==t.value):[t.value]:[...e,t.value],u({...c,scheduleTime:{...c.scheduleTime||(0,R.m)().scheduleTime,date:l}})},children:[(0,a.jsx)("span",{className:"text-[var(--text-primary)] text-[14px] leading-[22px] font-normal",children:t.label}),e.includes(t.value)&&(0,a.jsx)(D.A,{size:16,className:"text-[var(--icon-primary)]"})]},t.value))})}),children:(0,a.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between gap-2 pl-[16px] pr-[12px] h-[36px] w-full","rounded-lg","text-sm text-[var(--text-primary)]","truncate","bg-[var(--fill-tsp-white-main)]","hover:bg-[var(--fill-tsp-white-light)]","cursor-pointer"),children:[(0,a.jsx)("span",{className:(0,m.cn)("flex-1 truncate",!(null==e?void 0:e.length)&&"text-[var(--text-tertiary)]"),children:(null==e?void 0:e.length)?t.filter(t=>e.includes(t.value)).map(e=>e.label).join(g.I.t(", ")):g.I.t("Please select")}),(0,a.jsx)(E.A,{size:16,color:"var(--icon-tertiary)"})]})})),Y=(0,p.w)(()=>{var e;return(0,a.jsx)(S.A,{onVisibleChange:x,className:"w-[var(--anchor-width)]",content:(0,a.jsx)("div",{className:"bg-[var(--background-menu-white)] rounded-lg border border-white/5 shadow-lg",children:(0,a.jsx)("div",{className:"px-1 py-1 flex flex-col gap-0.5 max-h-[260px] overflow-y-auto",children:O.K.getTimeList().map(e=>{var t;let{value:l,label:i}=e,n=(null==c?void 0:null===(t=c.scheduleTime)||void 0===t?void 0:t.second)===l;return(0,a.jsxs)("div",{id:"time-option-".concat(l),className:(0,m.cn)("h-9 px-2 py-2 rounded-md flex items-center justify-between cursor-pointer","hover:bg-[var(--fill-tsp-white-main)]"),onClick:()=>{u({...c,scheduleTime:{...c.scheduleTime||(0,R.m)().scheduleTime,second:l}})},children:[(0,a.jsx)("span",{className:"text-[var(--text-primary)] text-[14px] leading-[22px] font-normal",children:i}),n&&(0,a.jsx)(D.A,{size:16,className:"text-[var(--icon-primary)]"})]},l)})})}),children:(0,a.jsxs)("button",{type:"button",className:(0,m.cn)("w-full flex items-center justify-between gap-2 pl-[16px] pr-[12px] h-[36px]","rounded-lg","text-sm text-[var(--text-primary)]","bg-[var(--fill-tsp-white-main)]","hover:bg-[var(--fill-tsp-white-light)]"),children:[(null===(e=O.K.getTimeList().find(e=>{var t;return e.value===(null==c?void 0:null===(t=c.scheduleTime)||void 0===t?void 0:t.second)}))||void 0===e?void 0:e.label)||"-",(0,a.jsx)(E.A,{size:16,color:"var(--icon-tertiary)"})]})})}),W=(0,p.w)(()=>{var e;return(null===(e=c.scheduleTime)||void 0===e?void 0:e.type)===y.uS.DAILY?2:3}),K=(0,p.w)(e=>{let t="";if(e===y.uS.NO_REPEAT)t=O.K.formatScheduleTime(c.scheduleTime);else{var l;t=P.Q.formatCustomScheduleTime((null===(l=c.scheduleTime)||void 0===l?void 0:l.interval)||0)}return(0,a.jsx)("div",{className:(0,m.cn)("flex items-center justify-between gap-2 px-3 py-[9px] w-max max-w-full rounded-lg","bg-[var(--fill-tsp-white-main)]"),children:(0,a.jsx)(M.m,{title:t,children:(0,a.jsx)("span",{className:"truncate text-sm text-[var(--text-tertiary)]",children:t})})})}),V=W()%2!=0;return(0,a.jsxs)("div",{className:"grid w-full grid-cols-2 gap-2 md:grid-cols-3",children:[C(),(null===(t=c.scheduleTime)||void 0===t?void 0:t.type)===y.uS.NO_REPEAT&&((null===(l=O.K.getTimeList().find(e=>{var t;return e.value===(null==c?void 0:null===(t=c.scheduleTime)||void 0===t?void 0:t.second)}))||void 0===l?void 0:l.label)?(0,a.jsxs)(a.Fragment,{children:[U(),(0,a.jsx)("div",{className:V?"col-span-2 md:col-span-1":"",children:Y()})]}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"col-span-1",children:K(y.uS.NO_REPEAT)})})),(null===(i=c.scheduleTime)||void 0===i?void 0:i.type)===y.uS.MONTHLY&&(0,a.jsxs)(a.Fragment,{children:[z((null===(n=c.scheduleTime)||void 0===n?void 0:n.date)||[],O.K.getMonthOptions()),(0,a.jsx)("div",{className:V?"col-span-2 md:col-span-1":"",children:Y()})]}),(null===(s=c.scheduleTime)||void 0===s?void 0:s.type)===y.uS.WEEKLY&&(0,a.jsxs)(a.Fragment,{children:[z((null===(r=c.scheduleTime)||void 0===r?void 0:r.date)||[],O.K.getWeekOptions()),(0,a.jsx)("div",{className:V?"col-span-2 md:col-span-1":"",children:Y()})]}),(null===(o=c.scheduleTime)||void 0===o?void 0:o.type)===y.uS.DAILY&&(0,a.jsx)("div",{className:V?"col-span-2 md:col-span-1":"",children:Y()}),(null===(d=c.scheduleTime)||void 0===d?void 0:d.type)===y.uS.INTERVAL&&(0,a.jsx)("div",{className:"col-span-1",children:K()})]})}function W(e){let{dataSource:t,onSubmit:l,onCancel:I,onDisposed:S,onDelete:N,isMobile:T}=e,k=(0,u._)(),{open:A}=(0,v.s)(j.A),E=(0,v.s)(n.p),[D,_]=(0,w.useState)(t);(0,w.useEffect)(()=>{var e;_({...t,connectors:null!==(e=t.connectors)&&void 0!==e?e:[]})},[t]);let[U,z]=(0,w.useState)(!1),[L,M]=(0,w.useState)(!1),F=!!D.uid,R=!D.name.trim()||!D.detail.trim(),P=(0,p.w)(e=>{let t=(0,b.A)(e),{scheduleTime:l}=t;return l&&([y.uS.NO_REPEAT,y.uS.DAILY].includes(null==l?void 0:l.type)?l.date=[]:(null==l?void 0:l.type)!==y.uS.NO_REPEAT&&(l.time=0)),{...t,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}}),O=(0,p.w)(async()=>{M(!0);try{let e=P(D);(null==D?void 0:D.uid)?(await k.updateItem(e),null==l||l(D),(0,f.oR)({title:g.I.t("Your scheduled task has been updated")})):(await k.addItem(e),null==l||l(D),(0,f.oR)({title:g.I.t("Your scheduled task has been created")})),null==S||S()}catch(t){let e=(0,h.O)(t);return(null==e?void 0:e.debug.code)==="400801"?((0,x.C)({eventName:"limit_dialog_show",extData:{source:"edit_schedule_task"}}),A()):(0,f.oR)({title:h.P.formatErrorToString(t),variant:"error"}),Promise.reject()}finally{M(!1)}}),W=(0,p.w)(async()=>{if(F){z(!0);try{await k.deleteItem(D),null==N||N(D),null==S||S()}catch(e){(0,f.oR)({title:h.P.formatErrorToString(e),variant:"error"})}finally{z(!1)}}}),V=(0,p.w)(()=>{null==I||I(),null==S||S()});return(0,a.jsxs)("form",{className:(0,m.cn)("flex flex-col pb-4 h-full justify-between"),children:[(0,a.jsxs)("div",{className:"pt-1.5 px-6 flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"w-full px-4 py-2 rounded-[10px] outline outline-1 outline-offset-[-1px] outline-[var(--border-main)] inline-flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"inline-flex flex-col items-start justify-start w-96",children:[(0,a.jsx)("div",{className:"justify-start text-text-primary text-sm leading-[20px] font-[500]",children:g.I.t("Task enabled")}),(0,a.jsx)("div",{className:"justify-start text-[var(--text-tertiary)] text-xs font-normal leading-[18px]",children:g.I.t("When turned off, {product} will pause this task.",{product:c.KR})})]}),(0,a.jsx)(d.d,{className:(0,m.cn)("flex-row-reverse"),checked:D.isEnable,onClick:async()=>{try{let e=!D.isEnable;if(e&&k.checkScheduleStatusForUpgrade(e,D.uid))return;_({...D,isEnable:e})}catch(e){(0,f.oR)({title:h.P.formatErrorToString(e),variant:"error"})}}})]}),(0,a.jsx)("fieldset",{children:(0,a.jsx)(K,{required:!0,label:g.I.t("Name"),children:(0,a.jsx)(s.p,{className:"h-[36px]",name:"name",autoFocus:!0,required:!0,value:D.name,autoComplete:"off",placeholder:g.I.t("Summary of AI news"),onChange:e=>{let t=e.target.value;_({...D,name:t.substring(0,50)})},onClear:()=>{_({...D,name:""})}})})}),(0,a.jsx)("fieldset",{children:(0,a.jsx)(K,{required:!0,label:g.I.t("Prompt"),children:(0,a.jsx)(o._,{name:"detail",placeholder:g.I.t("Search for yesterday's most impactful AI news and send me a brief summary."),className:(0,m.cn)("w-full h-[120px]"),required:!0,value:D.detail,onChange:e=>{_({...D,detail:e.target.value})},maxLength:5e3})})}),(0,a.jsx)("fieldset",{children:(0,a.jsx)(K,{label:g.I.t("Connectors (optional)"),children:(0,a.jsx)(C,{isMobile:T,formData:D,setFormData:_})})}),(0,a.jsx)("fieldset",{children:(0,a.jsx)(K,{label:g.I.t("Schedule"),children:(0,a.jsx)(Y,{formData:D,setFormData:_})})})]}),(0,a.jsxs)("footer",{className:(0,m.cn)("px-6 mt-6 pt-4 flex items-center justify-between gap-2 border-t border-[var(--border-light)]"),children:[T?null:F?(0,a.jsxs)(i.A,{disabled:U,className:(0,m.cn)("bg-transparent","border-[var(--function-error)]","rounded-[10px] gap-1","border border-[var(--Button-secondary-error-border)]","flex items-center justify-center","text-sm text-[var(--function-error)]","hover:opacity-80"),onClick:e=>{e.stopPropagation(),e.preventDefault(),E.open({title:g.I.t("Confirm task deletion"),content:g.I.t("Are you sure you want to end and delete this scheduled task?"),variant:"danger",onConfirm:async()=>(await W(),!0)})},children:[U&&(0,a.jsx)(r.R,{size:14,color:"var(--function-error)"}),g.I.t("Delete")]}):(0,a.jsx)("div",{}),T?(0,a.jsxs)("div",{className:"flex flex-row items-start justify-start w-full gap-2",children:[(0,a.jsx)(i.A,{className:(0,m.cn)("basis-0 grow min-h-12 min-w-[100px] relative rounded-xl shrink-0","flex items-center justify-center","transition-colors duration-150","active:scale-[0.98]"),onClick:V,children:g.I.t("Cancel")}),(0,a.jsx)(i.A,{color:"black",className:(0,m.cn)("basis-0 grow min-h-12 min-w-[100px] relative rounded-xl shrink-0","flex items-center justify-center","transition-colors duration-150","active:scale-[0.98]","disabled:opacity-50 disabled:cursor-not-allowed"),disabled:R||L,loading:L,onClick:O,children:g.I.t("Save")})]}):(0,a.jsxs)("div",{className:"flex items-center ",children:[(0,a.jsx)(i.A,{className:(0,m.cn)("min-w-[84px]","hover:opacity-80"),onClick:V,children:g.I.t("Cancel")}),(0,a.jsx)(i.A,{color:"black",className:(0,m.cn)("min-w-[84px] ml-[8px]"),disabled:R||L,loading:L,onClick:O,children:g.I.t("Save")})]})]})]})}function K(e){let{label:t,children:l,isRow:i,required:n}=e;return(0,a.jsxs)("div",{className:(0,m.cn)("flex gap-1.5",i?"flex-row":"flex-col"),children:[(0,a.jsxs)("label",{className:(0,m.cn)("flex items-center gap-1"),children:[(0,a.jsx)("span",{className:"text-[var(--text-primary)] text-[13px]",children:t}),n&&(0,a.jsx)("span",{className:"text-[var(--function-error)]",children:"*"})]}),l]})}},98417:(e,t,l)=>{l.d(t,{_:()=>r});var a=l(2635),i=l(33890),n=l(57271),s=l(69595);function r(e){let{dataSource:t,onDisposed:l}=e,r=t.uid?n.I.t("Edit scheduled task"):n.I.t("Add scheduled task");return(0,a.jsx)(i.l,{title:r,width:700,onDisposed:l,className:"bg-[var(--background-gray-main)]",children:(0,a.jsx)(s.p,{...e})})}},7171:(e,t,l)=>{l.d(t,{m:()=>r});var a=l(14960),i=l(57271),n=l(76656),s=l(30693);let r=()=>{let e=s.K.getNearest15SecondsToNow();return{uid:"",name:"",detail:"",isEnable:!0,status:n.L4.ACTIVE,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,latestSessionUid:"",locale:i.I.translationManager.locale,$typeName:"session.v1.ScheduledTaskInfo",scheduleTime:{$typeName:"session.v1.ScheduleTime",type:n.uS.NO_REPEAT,date:[1],second:e.value||0,time:s.K.getDayStartTimeStamp(new Date)/1e3,interval:0},createdAt:{$typeName:"google.protobuf.Timestamp",...a.F.dateToProtoTimestamp(new Date)},$unknown:[],playbook:"",parentTitle:"",parentSessionUid:"",connectors:[]}}},19413:(e,t,l)=>{l.d(t,{Q:()=>n});var a=l(57271);class i{formatCustomScheduleTime(e){if(!e)return"";let t=Math.floor(e/1440),l=Math.floor(e%1440/60),i=e%60;if(t>0)return l>0&&i>0?a.I.t("Every {days} {dayUnit}, {hours} {hourUnit} and {minutes} {minuteUnit}",{days:t,dayUnit:1===t?a.I.t("day"):a.I.t("days"),hours:l,hourUnit:1===l?a.I.t("hour"):a.I.t("hours"),minutes:i,minuteUnit:1===i?a.I.t("minute"):a.I.t("minutes")}):l>0?a.I.t("Every {days} {dayUnit} and {hours} {hourUnit}",{days:t,dayUnit:1===t?a.I.t("day"):a.I.t("days"),hours:l,hourUnit:1===l?a.I.t("hour"):a.I.t("hours")}):i>0?a.I.t("Every {days} {dayUnit} and {minutes} {minuteUnit}",{days:t,dayUnit:1===t?a.I.t("day"):a.I.t("days"),minutes:i,minuteUnit:1===i?a.I.t("minute"):a.I.t("minutes")}):a.I.t("Every {days} {dayUnit}",{days:t,dayUnit:1===t?a.I.t("day"):a.I.t("days")});if(l>0)return i>0?a.I.t("Every {hours} {hourUnit} and {minutes} {minuteUnit}",{hours:l,hourUnit:1===l?a.I.t("hour"):a.I.t("hours"),minutes:i,minuteUnit:1===i?a.I.t("minute"):a.I.t("minutes")}):a.I.t("Every {hours} {hourUnit}",{hours:l,hourUnit:1===l?a.I.t("hour"):a.I.t("hours")});{let e=i||1;return a.I.t("Every {minutes} {minuteUnit}",{minutes:i,minuteUnit:1===e?a.I.t("minute"):a.I.t("minutes")})}}}let n=new i},30693:(e,t,l)=>{l.d(t,{K:()=>r});var a=l(14960),i=l(76656),n=l(57271),s=l(19413);class r{static getHourMinuteBySeconds(e){return{hour:Math.floor(e/3600),minute:Math.floor(e%3600/60)}}static formatTimeToLabel(e){if(!(e>=0))return"";{let{hour:t,minute:l}=r.getHourMinuteBySeconds(e);return"".concat((0===t?0:t>12?t-12:t).toString().padStart(2,"0"),":").concat(l.toString().padStart(2,"0")," ").concat(t<12?"AM":"PM")}}static getNearest15SecondsToNow(){let e=new Date,t=3600*e.getHours()+60*e.getMinutes()+e.getSeconds(),l=r.getTimeList();return l.find(e=>e.value>t)||l[0]}static getTimeList(){let e=[];for(let t=0;t<24;t++)for(let l=0;l<60;l+=15){let a=3600*t+60*l,i=0===t?0:t%12==0?12:t%12,s=l.toString().padStart(2,"0"),r=t<12?n.I.t("{hour12}:{minuteStr} AM",{hour12:i,minuteStr:s}):n.I.t("{hour12}:{minuteStr} PM",{hour12:i,minuteStr:s});e.push({value:a,label:r})}return e}static getMonthOptions(){let e=[];for(let t=1;t<=31;t++)e.push({value:t,label:function(e){let t=n.I.translationManager.locale;if(["zh-CN","zh-TW","zh-HK","ja","ko"].includes(t)){let l=r.DAY_SUFFIXES[t]||"";return"".concat(e).concat(l)}return"de"===t?"der ".concat(e):"fr"===t?1===e?"1".concat(r.DAY_SUFFIXES.fr):"".concat(e):"it"===t?1===e?"1".concat(r.DAY_SUFFIXES.it):"".concat(e):"en"===t||t.startsWith("en-")?r.getOrdinal(e):"".concat(e)}(t)});return e}static getOrdinal(e){let t=["th","st","nd","rd"],l=e%100;return e+(t[(l-20)%10]||t[l]||"th")}static getWeekOptions(){return[{value:1,label:n.I.t("Monday")},{value:2,label:n.I.t("Tuesday")},{value:3,label:n.I.t("Wednesday")},{value:4,label:n.I.t("Thursday")},{value:5,label:n.I.t("Friday")},{value:6,label:n.I.t("Saturday")},{value:0,label:n.I.t("Sunday")}]}static formatScheduleTime(e){if(!e)return"";let t=(e=>{let t=r.getTimeList().find(t=>t.value===e);return(null==t?void 0:t.label)||r.formatTimeToLabel(e)})(e.second);switch(e.type){case i.uS.DAILY:return n.I.t("Daily at {time}",{time:t});case i.uS.WEEKLY:{let l;let a=r.getWeekOptions(),i=e.date.map(e=>{let t=a.find(t=>t.value===e);return null==t?void 0:t.label}).filter(e=>!!e);if(i.length>1){let e=i.pop();l=n.I.t("{beforeWeeks}, and {remainWeek}",{beforeWeeks:i.join(n.I.t(", ")),remainWeek:e})}else l="".concat(i[0]||"");return n.I.t("Weekly on {days} at {time}",{days:l,time:t})}case i.uS.MONTHLY:{let l;if(!e.date||0===e.date.length)return n.I.t("Monthly at {time}",{time:t});let a=r.getMonthOptions(),i=[...e.date].sort((e,t)=>e-t).map(e=>{let t=a.find(t=>t.value===e);return null==t?void 0:t.label}).filter(e=>!!e);if(i.length>1){let e=i.pop();l=n.I.t("{beforeDates}, and {remainDate}",{beforeDates:i.join(n.I.t(", ")),remainDate:e})}else l="".concat(i[0]||"");return n.I.t("Monthly on the {dates} at {time}",{dates:l,time:t})}case i.uS.NO_REPEAT:{let l=new Date(1e3*e.time);return n.I.t("{date} at {time}",{date:a.F.format(l.getTime(),"PPP"),time:t})}case i.uS.INTERVAL:return s.Q.formatCustomScheduleTime(e.interval)||n.I.t("Custom");default:return""}}}r.DAY_SUFFIXES={"zh-CN":"号","zh-TW":"號","zh-HK":"號",ja:"日",ko:"일",de:"der",fr:"er",it:"\xba"},r.getDayStartTimeStamp=e=>{if(!e)return Date.now();let t=new Date(e);return t.setHours(0,0,0,0),t.getTime()}}}]);